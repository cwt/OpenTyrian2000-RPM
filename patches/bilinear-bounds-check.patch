From f3dc53f25e0d8947e512ebd0c6538f1c6374abdd Mon Sep 17 00:00:00 2001
From: OpenTyrian Assistant <assistant@example.com>
Date: Thu, 18 Dec 2025 15:40:23 +0700
Subject: [PATCH] Add bounds checking to bilinear scaler to prevent
 out-of-bounds memory access

- Add additional safety bounds checking in both 32-bit and 16-bit bilinear scalers
- Prevent potential memory access violations during pixel interpolation
- Add continue statement to skip unsafe pixel calculations
---
 src/video_scale.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/video_scale.c b/src/video_scale.c
index bd91e02..c0b5c79 100644
--- a/src/video_scale.c
+++ b/src/video_scale.c
@@ -490,6 +490,11 @@ void bilinear_32(SDL_Surface *src_surface, SDL_Texture *dst_texture)
 			int x2 = (int_x < src_width - 1) ? int_x + 1 : int_x;
 			int y2 = (int_y < src_height - 1) ? int_y + 1 : int_y;
 
+			// Additional safety bounds checking to prevent out-of-bounds access
+			if (int_x >= src_width || int_y >= src_height || x2 >= src_width || y2 >= src_height) {
+				continue; // Skip this pixel to avoid memory access violation
+			}
+
 			// Get the four neighboring pixels
 			Uint32 p00 = rgb_palette[src[int_y * src_pitch + int_x]];
 			Uint32 p01 = rgb_palette[src[int_y * src_pitch + x2]];
@@ -586,6 +591,11 @@ void bilinear_16(SDL_Surface *src_surface, SDL_Texture *dst_texture)
 			int x2 = (int_x < src_width - 1) ? int_x + 1 : int_x;
 			int y2 = (int_y < src_height - 1) ? int_y + 1 : int_y;
 
+			// Additional safety bounds checking to prevent out-of-bounds access
+			if (int_x >= src_width || int_y >= src_height || x2 >= src_width || y2 >= src_height) {
+				continue; // Skip this pixel to avoid memory access violation
+			}
+
 			// Get the four neighboring pixels
 			Uint32 p00 = rgb_palette[src[int_y * src_pitch + int_x]];
 			Uint32 p01 = rgb_palette[src[int_y * src_pitch + x2]];
-- 
2.52.0

